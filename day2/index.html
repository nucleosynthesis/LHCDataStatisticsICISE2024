
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../day1/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Exercise 2 - LHCDataStatisticsICISE2024</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="light-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exercise-2-maximum-likelihood-fits" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LHCDataStatisticsICISE2024" class="md-header__button md-logo" aria-label="LHCDataStatisticsICISE2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LHCDataStatisticsICISE2024
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercise 2
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LHCDataStatisticsICISE2024" class="md-nav__button md-logo" aria-label="LHCDataStatisticsICISE2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LHCDataStatisticsICISE2024
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Exercises
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../day1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercise 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Exercise 2
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Exercise 2
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#datacards" class="md-nav__link">
    <span class="md-ellipsis">
      Datacards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performing-a-first-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Performing a first fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-additional-rate-modifiers" class="md-nav__link">
    <span class="md-ellipsis">
      Adding additional rate modifiers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#likelihood-scans" class="md-nav__link">
    <span class="md-ellipsis">
      Likelihood scans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goodness-of-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Goodness-of-fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-regions" class="md-nav__link">
    <span class="md-ellipsis">
      Control regions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#datacards" class="md-nav__link">
    <span class="md-ellipsis">
      Datacards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performing-a-first-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Performing a first fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-additional-rate-modifiers" class="md-nav__link">
    <span class="md-ellipsis">
      Adding additional rate modifiers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#likelihood-scans" class="md-nav__link">
    <span class="md-ellipsis">
      Likelihood scans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goodness-of-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Goodness-of-fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-regions" class="md-nav__link">
    <span class="md-ellipsis">
      Control regions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="exercise-2-maximum-likelihood-fits">Exercise 2 - Maximum Likelihood Fits</h1>
<p>From yesterday's exercise, we now have a set of histograms, from data and simulation, in our <code>.csv</code> file. Don't worry if you didn't manage to run over all of the samples from yesterday, you can use the pre-prepared file <code>ttbarAnalysis/exercise1solutions/signalregion_mbjj.csv</code>.</p>
<p>In today's exercises, we're going to use the CMS statistics software tool <code>combine</code> to extract statistical results from the data (and simulation) that we processed yesterday. <code>combine</code> is a software package that is designed with a command line interface that uses simple <code>.txt</code> files as inputs. You can find out lots more about the tool at the online documentation pages <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/">here</a>.</p>
<p>We'll begin by starting the container that has <code>combine</code> compiled for us. If you didn't download the container already, go back to the <a href="https://nucleosynthesis.github.io/LHCDataStatisticsICISE2024/setup/">Getting started</a> pages before continuing. </p>
<p>To do this, type the following into a terminal on your laptop (or by clicking the play button next to the <code>cms_combine</code> container in the Docker desktop application and using the terminal there).</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>docker<span class="w"> </span>start<span class="w"> </span>-i<span class="w"> </span>cms_combine
</span></code></pre></div>
<p>We'll also need to checkout the GitHub area since this is the first time we're using this container.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nucleosynthesis/LHCDataStatisticsICISE2024.git
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>LHCDataStatisticsICISE2024/ttbarAnalysis<span class="w"> </span>
</span></code></pre></div>
<p>Now that we're inside the container, start jupyter lab and enter the URL that gets printed to the screen in your preferred browser. </p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>jupyter<span class="w"> </span>lab<span class="w"> </span>--ip<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">8889</span><span class="w"> </span>--no-browser
</span></code></pre></div>
<h2 id="datacards">Datacards</h2>
<p>Create a new Text file and give it a name (I called mine <code>signalregion_mbjj.txt</code>). This text file will be the input to our <code>combine</code> commands - we call it a Datacard. Copy the text below into your text file. </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>imax 1
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>jmax 4
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>kmax 0
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a># -----------------------------------------------------------------------------------------
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>shapes data_obs signalregion signalregion_mbjj.csv signalregion:data:nominal,sum_w:sum_ww
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>shapes *        signalregion signalregion_mbjj.csv signalregion:$PROCESS:nominal,sum_w:sum_ww 
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a># -----------------------------------------------------------------------------------------
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>bin         signalregion
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>observation -1
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a># -----------------------------------------------------------------------------------------
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>bin         signalregion  signalregion        signalregion       signalregion   signalregion
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>process     ttbar         single_atop_t_chan  single_top_t_chan  single_top_tW  wjets
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>process     0             1                   2                  3              4
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>rate        -1            -1                  -1                 -1             -1
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a># -----------------------------------------------------------------------------------------
</span></code></pre></div>
<p>Let's go through these lines and see what they are doing. </p>
<p>The first lines, specifying <code>imax</code>, <code>jmax</code> and <code>kmax</code> indicate the number of channels, backgrounds and systematic uncertainties, respectively. In our case, we only have one channel (the signal region), and we have four background processes. Right now, we don't have any systematic uncertainties included but later on, we'll add some - for now, we keep this as 0. </p>
<p>The next lines (starting with <code>shapes</code>) say where <code>combine</code> will find the distributions (histograms) for the data and the different processes. The first line, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>shapes data_obs signalregion signalregion_mbjj.csv signalregion:data:nominal,sum_w:sum_ww
</span></code></pre></div>
says that the shape (distribution or histogram if you like) for the observed data can be found in our <code>signalregion_mbjj.csv</code> file in the rows where <code>process==data</code> and <code>systematic==nomial</code>. The final parts of the line say that the column <code>sum_w</code> represents the number of events in each bin. For the data <code>sum_ww</code> isn't used but this part of the line is needed for the code to work. </p>
<p>The next line is very similar 
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>shapes *        signalregion signalregion_mbjj.csv signalregion:$PROCESS:nominal,sum_w:sum_ww 
</span></code></pre></div>
This line is telling <code>combine</code> where to find the shapes for the signal and background processes. Here the <code>*</code> means that this applies for all of the processes. The keyword <code>$PROCESS</code> is expanded for each process that we define in the datacard. This is useful to avoid having to write the same datacard line over and over. </p>
<p>Next, we have a line that indicates the total numbers of events for the observed data and the different processes in our signal region. 
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>bin         signalregion
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>observation -1
</span></code></pre></div>
This tells <code>combine</code> that there is a channel called <code>signalregion</code>. The observation is usually a number but the <code>-1</code> there tells <code>combine</code> to go and calculate the total number of observed events by summing up the number of events in each bin - this saves us having to write the number each time. 
The next lines are similar, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>bin         signalregion  signalregion        signalregion       signalregion   signalregion
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>process     ttbar         single_atop_t_chan  single_top_t_chan  single_top_tW  wjets
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>process     0             1                   2                  3              4
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>rate        -1            -1                  -1                 -1             -1
</span></code></pre></div></p>
<p>This tells <code>combine</code> which processes are expected to contribution to the signal region. The names given should match the names in our <code>.csv</code> file so that the <code>shapes</code> line above will find the right histograms. Again, we use <code>-1</code> for the rate so that <code>combine</code> does the calculating for us. Finally, we also give a process ID. Any process with a value <span class="arithmatex"><span class="MathJax_Preview">\leq</span><script type="math/tex">\leq</script></span> will be considered a signal process, while any process with a value <span class="arithmatex"><span class="MathJax_Preview">&gt;0</span><script type="math/tex">>0</script></span> will be a background process. This is important later when we perform statistical tests. </p>
<h2 id="performing-a-first-fit">Performing a first fit</h2>
<p>Now that we have our Datacard written. We can perform some statistical calculations. We can perform a fit to the data, allowing the total rate of the <code>ttbar</code> process to vary. <code>combine</code> will automatically create a signal strength parameter - <code>r</code> which multiplies the rate of any signal process defined in the datacard. </p>
<p>We will use the <code>FitDiagnostics</code> method to extract the best fit value for the parameter <code>r</code> given the data we observed. We do this by typing the following command in a terminal (you can open a terminal in  jupyter lab), </p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>combine<span class="w"> </span>signalregion_mbjj.txt<span class="w"> </span>-M<span class="w"> </span>FitDiagnostics
</span></code></pre></div>
<p>You should get something similar to the output below 
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a> --- FitDiagnostics ---
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>Best fit r: 0.903186  -0.00366585/+0.00367476  (68% CL)
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Done in 0.01 min (cpu), 0.01 min (real)
</span></code></pre></div>
You will likely get some warnings about <code>PDF didn't factorize!</code> that you can safely ignore for now.</p>
<p>So it looks like the fit would prefer a value of the <span class="arithmatex"><span class="MathJax_Preview">tt</span><script type="math/tex">tt</script></span> cross-section around 10% smaller than the predicted value that we used when we processed the ttbar sample. You may have a different result if you are using your own <code>.csv</code> file. </p>
<p>Note that you also will now have files called <code>higgsCombineTest.FitDiagnostics.mH120.root</code> and <code>fitDiagnosticsTest.root</code> that got created from the above command. These files save the result in various ROOT object formats. We will use these  files later on, but for now you can just ignore this file. </p>
<p>Let's see if our data/simulation agreement has improved after the fit. We can do this by asking combine to create new templates after the fit. We run the command again, but this time, we will add options to save templates with uncertainties to the <code>fitDiagnosticsTest.root</code> file. </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>combine signalregion_mbjj.txt -M FitDiagnostics --saveShapes --saveWithUncert
</span></code></pre></div>
<p>If you are unfamiliar with ROOT, I have created a file called <code>root2py.py</code> with some handy functions to read and convert the objects into simple python arrays that can be used for plotting with matplotlib. Below is an example (written in pyROOT or just python) to make a plot of the distributions after the fit. You can copy either of these </p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">python</label><label for="__tabbed_1_2">pyROOT</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">from</span> <span class="nn">root2py</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span> <span class="nn">ROOT</span> 
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">file</span>   <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;fitDiagnosticsTest.root&quot;</span><span class="p">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">folder</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;shapes_fit_s/signalregion&quot;</span><span class="p">)</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">results</span> <span class="o">=</span> <span class="n">getHistogramCountsAndData</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="n">nsamples</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">])</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="n">bin_centres</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="n">bins_list</span>   <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)]</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="n">bin_boundaries</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="n">samples_stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)]</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="n">labels</span>        <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)]</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="n">data_errs</span>     <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins_list</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bin_boundaries</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">samples_stack</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>             <span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">data_errs</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>             <span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>             <span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>             <span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">4.0</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>             <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>             <span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="c1"># calculate min and max from total errors on prediction for filled area</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="c1"># we need to add left most and right most bin edge for this to work </span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="n">totalED</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="n">totalEU</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="n">totalED</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">totalED</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">totalED</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="n">totalED</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalED</span><span class="p">,</span><span class="n">totalED</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="n">totalEU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">totalEU</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">totalEU</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="n">totalEU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalEU</span><span class="p">,</span><span class="n">totalEU</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="n">bin_centres_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="n">bin_centres_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bin_centres_x</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">))</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">bin_centres_x</span><span class="p">,</span><span class="n">totalED</span><span class="p">,</span><span class="n">totalEU</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">)</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.3e4</span><span class="p">)</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">import</span> <span class="nn">ROOT</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">canvas</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">file</span>   <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;fitDiagnosticsTest.root&quot;</span><span class="p">)</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">folder</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;shapes_fit_s/signalregion&quot;</span><span class="p">)</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">data</span>  <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GetN</span><span class="p">())</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">total</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;total&quot;</span><span class="p">);</span> <span class="n">total</span><span class="o">.</span><span class="n">SetFillColor</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">kGray</span><span class="p">)</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="n">ttbar</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;ttbar&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">ttbar</span><span class="o">.</span><span class="n">SetFillColor</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">kOrange</span><span class="p">)</span> <span class="p">;</span> <span class="n">ttbar</span><span class="o">.</span><span class="n">SetFillStyle</span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="n">wjets</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;wjets&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">wjets</span><span class="o">.</span><span class="n">SetFillColor</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">kRed</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="n">single_top_tW</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;single_top_tW&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">single_top_tW</span><span class="o">.</span><span class="n">SetFillColor</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">kBlue</span><span class="p">)</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="n">single_atop_t_chan</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;single_atop_t_chan&quot;</span><span class="p">);</span> <span class="n">single_atop_t_chan</span><span class="o">.</span><span class="n">SetFillColor</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">kBlue</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="n">single_top_t_chan</span>  <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;single_top_t_chan&quot;</span><span class="p">);</span> <span class="n">single_top_t_chan</span><span class="o">.</span><span class="n">SetFillColor</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">kBlue</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="c1"># create legend and stack and fill them</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="n">legend</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TLegend</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.89</span><span class="p">,</span><span class="mf">0.89</span><span class="p">)</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="n">legend</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="s2">&quot;pe&quot;</span><span class="p">)</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="n">stk</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">THStack</span><span class="p">(</span><span class="s2">&quot;stack&quot;</span><span class="p">,</span><span class="s2">&quot;;;Events&quot;</span><span class="p">)</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="n">stk</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">single_top_t_chan</span><span class="p">);</span> <span class="n">legend</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="n">single_top_t_chan</span><span class="p">,</span><span class="s2">&quot;single_top_t_chan&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="n">stk</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">single_atop_t_chan</span><span class="p">);</span> <span class="n">legend</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="n">single_atop_t_chan</span><span class="p">,</span><span class="s2">&quot;single_atop_t_chan&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="n">stk</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">single_top_tW</span><span class="p">);</span> <span class="n">legend</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="n">single_top_tW</span><span class="p">,</span><span class="s2">&quot;single_top_tW&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="n">stk</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wjets</span><span class="p">);</span> <span class="n">legend</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="n">wjets</span><span class="p">,</span><span class="s2">&quot;wjets&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="n">stk</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ttbar</span><span class="p">);</span> <span class="n">legend</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="n">ttbar</span><span class="p">,</span><span class="s2">&quot;ttbar&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="c1">#data.Draw(&quot;ApE&quot;)</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="n">stk</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;hist&quot;</span><span class="p">)</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="n">data</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;pE&quot;</span><span class="p">)</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="c1">#ttbar.Draw(&quot;histsame&quot;)</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="n">total</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;E2same&quot;</span><span class="p">)</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="n">legend</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="n">canvas</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Challenge</p>
<p>Add a ratio panel below the main plot that shows data/total expected. This can be a good way to judge more easily by eye how well the data and predictions agree after the fit. </p>
</div>
<h2 id="adding-additional-rate-modifiers">Adding additional rate modifiers</h2>
<p>The agreement looks a little better than before but we could still do better. We should also allow our dominant background process (<code>wjets</code>) to float so that the fit can adjust the total rate. </p>
<p>Add the following line to your Datacard, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>wjets_norm rateParam signalregion wjets 1 [0,5]
</span></code></pre></div></p>
<p>This line tells combine to add a new parameter to the model that multiplies the rate of the specified process, in the specified channel. The new parameters will be <code>wjets_norm</code>, which multiplies the rate of the <code>wjets</code> process. We've chosen the default value of the parameter to be 1 and allowed its range to vary between 0 and 5. </p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Run the <code>-M FitDiagnostics</code> method again and plot the new best fit shapes. Does the agreement improve compared to before? What are the values of the fitted rate multipliers (add the option <code>-v 3</code> to get combine to print this information).</p>
</div>
<details>
<summary>Show answer</summary>
<p>By running
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>combine signalregion_mbjj.txt -M FitDiagnostics -v 3 --saveShapes --saveWithUncert
</span></code></pre></div>
we now find in the output 
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>r          = 0.824465     +/-  0.0115119 (limited)
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>wjets_norm = 2.45416      +/-  0.203045  (limited)
</span></code></pre></div>
Now we see that the fit would prefer to scale up the <code>wjets</code> process by a factor of ~2.45 compared to our original prediction. The best-fit value for the signal strength has also changed from what we saw before. </p>
<p>If we look at a plot of the fit results we can see things are a little improved. The plot below is made using the pyROOT version of our plotting code. </p>
<p><img alt="fit with floatng wjets" src="../images/fit_s_wjets_float.jpg" /></p>
<p>Remember, your results might be different if you're using your own solution from the first exercise. </p>
</details>
<p>You may have noticed that in addition to the best fit value, <code>combine</code> reports an uncertainty <code>+/-</code>. We will cover what we mean by uncertainty in the lectures, but this uncertainty is estimated by using the inverse of the Hessian matrix from the fit result. From this alone, we can see that by including an additional parameter, the uncertainty on our best fit for <code>r</code> has increased. Generally, we expect that adding freedom to the fit will increase the uncertainty of our results but improve the overall agreement in our data/simulation plots.  </p>
<p>We can estimate this uncertainty more accurately by scanning the <em>profiled log-likelihood</em> and comparing this for the two cases; with and without the <code>wjets_norm</code> parameter. </p>
<h2 id="likelihood-scans">Likelihood scans</h2>
<p>Remember in the lectures, we define a quantity <span class="arithmatex"><span class="MathJax_Preview">q(r)</span><script type="math/tex">q(r)</script></span> as the following, </p>
<div class="arithmatex">
<div class="MathJax_Preview">
q(r) = -2\ln \frac{L(r,\hat{\nu}_{r})}{L(\hat{r},\hat{\nu})}
</div>
<script type="math/tex; mode=display">
q(r) = -2\ln \frac{L(r,\hat{\nu}_{r})}{L(\hat{r},\hat{\nu})}
</script>
</div>
<p>where the <span class="arithmatex"><span class="MathJax_Preview">\hat{\cdot}</span><script type="math/tex">\hat{\cdot}</script></span> notation means the maximum likelihood estimate (or best-fit) and the subscript and where <span class="arithmatex"><span class="MathJax_Preview">\nu</span><script type="math/tex">\nu</script></span> represents our nuisance parameters. In this case, we only have one such nuisance parameter which is <code>wjets_norm</code>. The value <span class="arithmatex"><span class="MathJax_Preview">\hat{\nu}_{r}</span><script type="math/tex">\hat{\nu}_{r}</script></span> is the value of <span class="arithmatex"><span class="MathJax_Preview">\nu</span><script type="math/tex">\nu</script></span> for that maximises the likelihood when <span class="arithmatex"><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> is fixed to a specific value - sometimes we call this the conditional maximum likelihood. </p>
<p><code>combine</code> can calculate this quantity as a function of our parameter <span class="arithmatex"><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> using the <code>-M MultiDimFit</code> method and the <code>grid</code> algo with the command, </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>combine signalregion_mbjj.txt -M MultiDimFit --algo grid --points 50 --setParameterRanges r=0.7,1
</span></code></pre></div>
<p>The option <code>--points</code> tells combine how many evenly spaced points at which to evaluate the function <span class="arithmatex"><span class="MathJax_Preview">q(r)</span><script type="math/tex">q(r)</script></span> and the last option specifies the range that those points should be in. After running this command, there will be a new ROOT file called <code>higgsCombineTest.MultiDimFit.mH120.root</code> in your file browser. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you run the <code>combine</code> command twice, the output file will be overwritten. By adding the option <code>-n name</code>, you can avoid this as the word <code>Test</code> will be modified to <code>name</code> that you specify. Use this to keep track of different results.  </p>
</div>
<p>This file contains a <code>TTree</code> that stores the values of <span class="arithmatex"><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> and <span class="arithmatex"><span class="MathJax_Preview">0.5\times q(r)</span><script type="math/tex">0.5\times q(r)</script></span> in its branches. In the python file <code>root2py.py</code> I have included a function to convert these into python arrays for you. You can plot the value of <span class="arithmatex"><span class="MathJax_Preview">q(r)</span><script type="math/tex">q(r)</script></span> using one of the blocks of code below, depending on if you prefer pyROOT or straight python. </p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">python</label><label for="__tabbed_2_2">pyROOT</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">root2py</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kn">import</span> <span class="nn">ROOT</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">fscan</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;higgsCombineTest.MultiDimFit.mH120.root&quot;</span><span class="p">)</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">tree</span>  <span class="o">=</span> <span class="n">fscan</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">get2DeltaNLLScan</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> 
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">import</span> <span class="nn">ROOT</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">fscan</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;higgsCombineTest.MultiDimFit.mH120.root&quot;</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">tree</span>  <span class="o">=</span> <span class="n">fscan</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">canvas</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;2*deltaNLL:r&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">canvas</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Make a plot of <span class="arithmatex"><span class="MathJax_Preview">q(r)</span><script type="math/tex">q(r)</script></span> for the case where the rate of <code>wjets</code> is allowed to float and where it is fixed to the original value, on the same axis. Which one is wider? What does that tell us?</p>
</div>
<details>
<summary>Show answer</summary>
<p>You should find something like the plot below by using the code provided above and modifying to plot two scans on top of one another. </p>
<p><img alt="Compare Scans" src="../images/scancompared2.jpg" /></p>
<p>The scan where the rate of <code>wjets</code> is allowed to float is much wider than the original scan. </p>
</details>
<div class="admonition tip">
<p class="admonition-title">Challenge</p>
<p>To estimate the uncertainty, we can define confidence intervals, according to Wilks' theorem, as the region for which <span class="arithmatex"><span class="MathJax_Preview">q(r)&lt; x_{\alpha}</span><script type="math/tex">q(r)< x_{\alpha}</script></span> where <span class="arithmatex"><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span> is our test size. For <span class="arithmatex"><span class="MathJax_Preview">1-\alpha=0.683</span><script type="math/tex">1-\alpha=0.683</script></span>, i.e a 68.3% confidence interval, <span class="arithmatex"><span class="MathJax_Preview">x_{\alpha}=1</span><script type="math/tex">x_{\alpha}=1</script></span>. Find the 68.3% intervals for each of the scans using this method. </p>
</div>
<h2 id="goodness-of-fit">Goodness-of-fit</h2>
<p>Instead of comparing our data/simulation plots by eye, we can use a measure of the Goodness-of-fit. In lectures we learned about hypothesis testing. <code>combine</code> has several routines for calculating a goodness-of-fit, but we will just use the so called <code>saturated</code> test for an idea of the fit quality. </p>
<p>The test-statistic for a template model is, </p>
<p>$$
    t = -2\ln\frac{L(\hat{r},\hat{\theta})}{L_{s}}
$$
where <span class="arithmatex"><span class="MathJax_Preview">L_{s}</span><script type="math/tex">L_{s}</script></span> is the <em>saturated likelihood</em>. It is defined as the likelihood valye where the expected value in each bin is exactly the same as the observed value - i.e the very largest possible likelihood value given the data observed. </p>
<p>We can calculate this value with <code>combine</code> using the following, 
<div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>combine<span class="w"> </span>signalregion_mbjj.txt<span class="w"> </span>-M<span class="w"> </span>GoodnessOfFit<span class="w"> </span>--algo<span class="o">=</span>saturated
</span></code></pre></div></p>
<p>A result in the literature (Wilks' theorem) tells us that for large statistics samples (in the asymptotic limit), this test statistic will be distributed according to a <span class="arithmatex"><span class="MathJax_Preview">\chi^{2}</span><script type="math/tex">\chi^{2}</script></span> distribution with <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> degrees of freedom where <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> is the number of bins in the distribution minus the number of parameters in the fit - in our case this is <span class="arithmatex"><span class="MathJax_Preview">n=20-2=18</span><script type="math/tex">n=20-2=18</script></span>. This means, we can convert the number calculated by combine to a <span class="arithmatex"><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>-value using, </p>
<div class="arithmatex">
<div class="MathJax_Preview">
p = \int_{t}^{+\infty} \chi^{2}(n)dt 
</div>
<script type="math/tex; mode=display">
p = \int_{t}^{+\infty} \chi^{2}(n)dt 
</script>
</div>
<p>or in code form using the function below 
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>import ROOT 
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>ROOT.TMath.Prob(t,18)
</span></code></pre></div></p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Calculate the <span class="arithmatex"><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>-value for both cases (with and without the <code>wjets_norm</code> parameter). Which one is better? </p>
</div>
<details>
<summary>Show answer</summary>
<p>You should find a very very small value in both cases so both fits are pretty awful. </p>
</details>
<div class="admonition tip">
<p class="admonition-title">Challenge</p>
<p>In the <code>combine</code> online documentation, on <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/part3/commonstatsmethods/#goodness-of-fit-tests">Goodness of fit tests</a>, you can find instructions for calculating <span class="arithmatex"><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>-values using toys rather than relying on asymptotic methods. Calculate the <span class="arithmatex"><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>-values for the two cases using the saturated algorithm.</p>
</div>
<h2 id="control-regions">Control regions</h2>
<p>In the previous examples we saw that we can trade between sensitivity in our measurement (the uncertainty in <code>r</code>) and quality of the fit result. In an ideal world, we would have a good overall quality of the fit and a reasonably small uncertainty in our results. </p>
<p>We saw that the fit improved when allowing the rate of <code>wjets</code> to float in the fit, but at the cost of increased uncertainty in <code>r</code>. We can improve this by constraining the parameter <code>wjets_norm</code> using a control region. </p>
<p>A control region is another region in the data that is dominated by a particular background process. By including this region in the fit, we will be able to use that additional data to constrain the <code>wjets_norm</code> parameter. </p>
<p>Let's go back to the <code>cms_python</code> container and modify our analysis notebook to create a control region that will be dominated by the <code>wjets</code> process. If you didn't manage to get a working analysis yesterday, you can use the notebook provided <code>ttbarAnalysis/exercise1solutions/FullAnalysis.ipynb</code>. </p>
<p>We need to change how we are filtering our events, we want to modify the selection so that we choose events with no b-tagged jets but everything else is the same, i.e change,   </p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>(ak.sum(selected_jets.btag &gt;= 0.8, axis=1) &gt;= 2)
</span></code></pre></div>
to 
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>(ak.sum(selected_jets.btag &gt;= 0.8, axis=1) &lt; 1)
</span></code></pre></div></p>
<p>Our observable will be different now since we no longer want to pick the trijet with a b-quark. Instead we just use the trijet with the largest <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>, i.e we change the observable calcualtion to 
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>trijet = ak.combinations(selected_events_CR, 3, fields=[&quot;j1&quot;, &quot;j2&quot;, &quot;j3&quot;])
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>j1,j2,j3 = ak.unzip(trijet)
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>trijet[&quot;p4&quot;] = trijet.j1 + trijet.j2 + trijet.j3
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>trijet_mass = trijet[&quot;p4&quot;][ak.argmax(trijet.p4.pt, axis=1, keepdims=True)].mass
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>observable = ak.flatten(trijet_mass).to_numpy()
</span></code></pre></div>
for the control region. We will use this control region in combination with our signal region in tomorrow's exercise. </p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Write a new notebook to process the events but this time applying the control region selection. 
If you prefer, you can instead modify your original notebook so that it can process the events for the signal region and control region at the same time! Remember, 
   - Also modify the name of the output file to something like <code>controlregion_mbjj.csv</code> so as not to overwrite our signal region. 
   - You should name the channel for the control region something like "<code>controlregion</code>" as we'll use this name for our datacards later - remember this when using the <code>histogramToDataframe</code> function. 
   - We also want to include the histograms for the jes up and down variations just like we did in the control region. </p>
</div>
<details>
<summary>Show answer</summary>
<p>I have uploaded a Jupyter notebook that will perform the  analysis on the samples and produce both the signal region and control region in a single output <code>.csv</code> called <code>allregions.csv</code>. The notebook os called <code>FullAnalysisWithControlRegion.ipynb</code>in the <code>ttbarAnalysis</code> folder. If you really get stuck, have a look at this notebook to see how to run our object and event selection, calculate the observable and save the histograms for all of the samples this time with the control region. </p>
<p>The distributions in the control region should look something like the plot below </p>
<p><img alt="mbjj_control" src="../images/mbjj_controlregion.png" /></p>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../day1/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Exercise 1">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Exercise 1
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "navigation.footer"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>