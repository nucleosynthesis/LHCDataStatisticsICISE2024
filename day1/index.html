
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../setup/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Exercise 1 - LHCDataStatisticsICISE2024</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="light-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exercise-1-datasets-selections-and-histograms" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LHCDataStatisticsICISE2024" class="md-header__button md-logo" aria-label="LHCDataStatisticsICISE2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LHCDataStatisticsICISE2024
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercise 1
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LHCDataStatisticsICISE2024" class="md-nav__button md-logo" aria-label="LHCDataStatisticsICISE2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LHCDataStatisticsICISE2024
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Exercises
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Exercise 1
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Exercise 1
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#launch-jupyterlab" class="md-nav__link">
    <span class="md-ellipsis">
      Launch JupyterLab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-and-exploring-the-data-sets" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing and exploring the data sets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-a-basic-analysis-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Applying a basic analysis selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying a basic analysis selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#object-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Object selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Event selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#histograms-and-saving-output" class="md-nav__link">
    <span class="md-ellipsis">
      Histograms and saving output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Full analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#launch-jupyterlab" class="md-nav__link">
    <span class="md-ellipsis">
      Launch JupyterLab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-and-exploring-the-data-sets" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing and exploring the data sets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-a-basic-analysis-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Applying a basic analysis selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying a basic analysis selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#object-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Object selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Event selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#histograms-and-saving-output" class="md-nav__link">
    <span class="md-ellipsis">
      Histograms and saving output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Full analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="exercise-1-datasets-selections-and-histograms">Exercise 1 - Datasets, Selections and Histograms</h1>
<p>For the exercises, we will use a simplified version of a <a href="https://link.springer.com/content/pdf/10.1007/JHEP09(2017)051.pdf">CMS analysis</a> to measure the production cross-section of top-quark / anti-top-quark pairs - <span class="arithmatex"><span class="MathJax_Preview">\sigma_{tt}</span><script type="math/tex">\sigma_{tt}</script></span> - in proton-proton collisions at a centre of mass energy of 13 TeV. We will be using real data from the CMS experiment, taken in 2015 during Run 2 of the LHC. The code is based on the CMS open data workshop linked <a href="https://cms-opendata-workshop.github.io/workshopwhepp-lesson-ttbarljetsanalysis/">here</a>, which you can read through if you are interested. </p>
<p>The image below is a Feynman diagram of the process we are interested in measuring, namely <span class="arithmatex"><span class="MathJax_Preview">t\bar{t}\rightarrow (bW^{+})(bW^{-})\rightarrow bq\bar{q}bl^{-}\bar{\nu}_{l}</span><script type="math/tex">t\bar{t}\rightarrow (bW^{+})(bW^{-})\rightarrow bq\bar{q}bl^{-}\bar{\nu}_{l}</script></span> - the lepton+jets final state. </p>
<p><img alt="TT lepton + jets Feynman Diagram" src="../images/ttbar_diagram.png" /></p>
<p>In our example, we will focus on the case where the lepton <span class="arithmatex"><span class="MathJax_Preview">l</span><script type="math/tex">l</script></span> is an electron or muon.  In the CMS detector, these leptons are extremely well measured and are very good for "triggering" the events that we are interested in. Looking at the final state, we would also expect to see 4 hadronic jets, two of which will be <span class="arithmatex"><span class="MathJax_Preview">b-</span><script type="math/tex">b-</script></span>jets, and missing transverse momentum from the neutrino which isn't detected.  </p>
<h2 id="launch-jupyterlab">Launch JupyterLab</h2>
<p>For this exercise, we will be using data from the LHC Run-2 proton-proton collision data recorded by CMS during 2015. 
In addition to the data, we will be using simulated samples of <span class="arithmatex"><span class="MathJax_Preview">t\bar{t}\rightarrow (bW^{+})(bW^{-})\rightarrow bq\bar{q}bl^{-}\bar{\nu}_{l}</span><script type="math/tex">t\bar{t}\rightarrow (bW^{+})(bW^{-})\rightarrow bq\bar{q}bl^{-}\bar{\nu}_{l}</script></span> production and various background processes that can mimic the signal. </p>
<p>First, start the <code>cms_python</code> container using 
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>docker start -i cms_python
</span></code></pre></div>
Note that you should have the Docker desktop running on your laptop for this to work. If you didn't install the container already, please see the <a href="https://nucleosynthesis.github.io/LHCDataStatisticsICISE2024/setup/">Getting started</a> pages before continuing. </p>
<p>Next, you should checkout the GitHub area that contains some helpful files and information for accessing and processing the data. In the same terminal as you started the container in type, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>git clone https://github.com/nucleosynthesis/LHCDataStatisticsICISE2024.git
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>cd LHCDataStatisticsICISE2024/ttbarAnalysis 
</span></code></pre></div></p>
<p>Now you can start the JupyterLab server by running 
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>jupyter lab --ip 0.0.0.0 --port 8888 --no-browser
</span></code></pre></div></p>
<p>The output will give you a link (starting with <code>http://</code>) that you can paste into your preferred internet browser to open the JuypterLab session. Create a new Python 3 notebook - icon that says <em>Python 3 (ipykernel)</em> - and give it a name by right clicking in the file browser at the left panel where it says "Untitled.ipynb". We will use this notebook to issue commands to process the data. </p>
<p>You can create new cells in the notebook by using the "+" icon at the top. The code that is entered in each cell can be run by either clicking the play icon at the top or by selecting the cell and pressing <strong>Shift + Enter</strong> on your keyboard. Jupyter notebooks are a great way of editing code and displaying output all in one place! </p>
<h2 id="accessing-and-exploring-the-data-sets">Accessing and exploring the data sets</h2>
<p>In your JupyterLab file browser, you will see the list of files that were obtained from GitHub. There is a file called <code>ntuples.json</code> that contains the file paths for the different samples (data and simulation) that we'll use in these exercises. </p>
<p>In the file browser, if you click on the <code>ntuple.json</code> file, it will open in the main panel. You can click on the different names to expand them and see the information contained in the file. It should look like the image below, </p>
<p><img alt="Ntuples" src="../images/ntuples.jpg" /></p>
<p>These datasets have been <em>skimmed</em> by applying certain selection criteria. This is to make the samples more manageable as the original datasets are TBs in size! The requirements applied are, </p>
<ul>
<li>That the events fired at least one of these triggers: <code>HLT_Ele22_eta2p1_WPLoose_Gsf</code>, <code>HLT_IsoMu20_v</code>, <code>HLT_IsoTkMu20_v</code>. These essentially require that the online selection (trigger) found at least one isolated electron or one isolated muon with a minimum <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>, in a certain part of the CMS detector (can you figure out from the names, what the <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span> requirements at the online selection are?). </li>
<li>That the event contains either at least one tight electron or at least one tight muon with <span class="arithmatex"><span class="MathJax_Preview">p_{T}&gt; 26</span><script type="math/tex">p_{T}> 26</script></span> GeV and <span class="arithmatex"><span class="MathJax_Preview">|\eta|&lt;2.1</span><script type="math/tex">|\eta|<2.1</script></span>. When we use the word tight in this context, it is jargon internal to CMS that just specifies how pure we are trying to make the sample. A tight selection criteria would be quite pure and have fewer false positives than a medium or loose selection which might retain more true muons or electrons, but also have more false positives (fake electrons or muons). </li>
</ul>
<p>The data are saved as <code>.root</code> files. Don't worry if you are not familiar with the ROOT software, we will some very nice Python tools from the Hep Software Foundation to read these files and convert them into Python based formats. </p>
<p>Copy the code below into a cell in your Jupyter notebook. This imports the various modules that we need to read and convert our data into Python formats. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span> <span class="nn">uproot</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span> <span class="nn">awkward</span> <span class="k">as</span> <span class="nn">ak</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">from</span> <span class="nn">coffea.nanoevents</span> <span class="kn">import</span> <span class="n">NanoEventsFactory</span><span class="p">,</span> <span class="n">BaseSchema</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kn">from</span> <span class="nn">agc_schema</span> <span class="kn">import</span> <span class="n">AGCSchema</span>
</span></code></pre></div>
<p>Run the cell to execute the commands. You should see the cell number (eg <code>[1]</code>) become an asterisk (<code>[*]</code>) for a short while, which indicates that the cell is running. Once the commands have finished, the number will appear again. </p>
<p>Next, let's open one of the files from the <code>ttbar</code> sample. Copy the command below into the next cell of your Jupyter notebook and run it. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">events</span> <span class="o">=</span> <span class="n">NanoEventsFactory</span><span class="o">.</span><span class="n">from_root</span><span class="p">(</span><span class="s1">&#39;root://eospublic.cern.ch//eos/opendata/cms/derived-data/POET/23-Jul-22/RunIIFall15MiniAODv2_TT_TuneCUETP8M1_13TeV-powheg-pythia8_flat/00EFE6B3-01FE-4FBF-ADCB-2921D5903E44_flat.root&#39;</span><span class="p">,</span> <span class="n">schemaclass</span><span class="o">=</span><span class="n">AGCSchema</span><span class="p">,</span> <span class="n">treepath</span><span class="o">=</span><span class="s1">&#39;events&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
</span></code></pre></div>
<p>The output should be a list of the different collections (fields) that are contained in the data. Each event may have a different number of objects in each collection. We can see this by entering the following code in the Jupyter notebook cell, </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Electrons:&quot;</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of events: </span><span class="si">{</span><span class="n">ak</span><span class="o">.</span><span class="n">num</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">num</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nb">print</span><span class="p">()</span>
</span></code></pre></div>
<p>The output should look like 
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Electrons:
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Number of events: 325519
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>[3, 2, 2, 1, 1, 2, 0, 1, 2, 3, 1, 1, 3, 4, ... 4, 1, 1, 2, 5, 3, 1, 2, 2, 2, 1, 2, 1]
</span></code></pre></div></p>
<p>From this we can see that there are 325519 events in total in this file and each event has a different number of electrons. Notice that we used the same <code>ak.num</code> command in each printout but we changed the depth of the sum by specifying <code>axis=</code>. The larger this number, the deeper into the event structure the function goes. </p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Do the same for <code>muon</code>, <code>jet</code> and <code>met</code> in each event, to see how many of these objects are contained in each event. Why do you get an error when using the function for <code>met</code>, the missing transverse momentum of the event?  </p>
</div>
<details>
<summary><b>Show answer</b></summary>

Similarly to the case for electrons, we can use the following, 
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Muons:&quot;</span><span class="p">)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of events: </span><span class="si">{</span><span class="n">ak</span><span class="o">.</span><span class="n">num</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">num</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nb">print</span><span class="p">()</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Jets:&quot;</span><span class="p">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of events: </span><span class="si">{</span><span class="n">ak</span><span class="o">.</span><span class="n">num</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="nb">print</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">num</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></code></pre></div>

Which yields the output, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Muons:
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Number of events: 325519
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>[1, 1, 1, 0, 6, 6, 3, 2, 1, 2, 2, 6, 4, 2, ... 2, 1, 1, 2, 0, 5, 2, 3, 2, 2, 2, 2, 1]
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>Jets:
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>Number of events: 325519
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>[4, 5, 4, 5, 9, 4, 4, 8, 5, 9, 5, 4, 6, 6, ... 6, 2, 4, 3, 5, 9, 4, 7, 4, 4, 6, 5, 4]
</span></code></pre></div>

When doing the same for <code>met</code>, we get an error 
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>ValueError: &#39;axis&#39; out of range for &#39;num&#39;
</span></code></pre></div>

The reason is that the <code>met</code> field is an <b>event level variable</b> meaning it is calculated only once per event. 
</details>

<h2 id="applying-a-basic-analysis-selection">Applying a basic analysis selection</h2>
<p>We will apply selections to the events to discard those that are unlikely to have arisen from our target (signal) process <span class="arithmatex"><span class="MathJax_Preview">t\bar{t}\rightarrow (bW^{+})(bW^{-})\rightarrow bq\bar{q}bl^{-}\bar{\nu}_{l}</span><script type="math/tex">t\bar{t}\rightarrow (bW^{+})(bW^{-})\rightarrow bq\bar{q}bl^{-}\bar{\nu}_{l}</script></span>. </p>
<p>Looking at the process, its clear that we should select events that have one muon or one electron, along with at least four jets which are either from a light flavour quark or from a b-quark (<span class="arithmatex"><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> or <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>). </p>
<p>Generally, when applying selections to events, we first think about <em>object selection</em> - i.e we only want to apply event selections using well identified objects, and then <em>event selection</em> where we really target the final state that we are looking for. </p>
<h3 id="object-selection">Object selection</h3>
<p>We can see which features each of our collections have by checking the <code>fields</code> available. Copy the following code into a Juptyer notebook cell, 
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Electron fields:&quot;</span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nb">print</span><span class="p">()</span>
</span></code></pre></div>
This should give the following output, </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>Electron fields:
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>[&#39;pt&#39;, &#39;px&#39;, &#39;py&#39;, &#39;pz&#39;, &#39;eta&#39;, &#39;phi&#39;, &#39;ch&#39;, &#39;iso&#39;, &#39;veto&#39;, &#39;isLoose&#39;, &#39;isMedium&#39;, &#39;isTight&#39;, &#39;dxy&#39;, &#39;dz&#39;, &#39;dxyError&#39;, &#39;dzError&#39;, &#39;ismvaLoose&#39;, &#39;ismvaTight&#39;, &#39;ip3d&#39;, &#39;sip3d&#39;, &#39;energy&#39;]
</span></code></pre></div>
<p>We can see that the electrons have fields corresponding to, </p>
<ul>
<li>The kinematics of the electron: transverse momentum <code>pt</code> (<span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>), pseudo-rapidity <code>eta</code> (<span class="arithmatex"><span class="MathJax_Preview">\eta</span><script type="math/tex">\eta</script></span>)</li>
<li>Identification quality information : Whether the electron passes loose, medium or tight selection requirements : <code>isLoose</code>, <code>isMedium</code>, <code>isTight</code>. </li>
<li>Other features related to the track-calorimeter matching and how well isolated the electron object is. </li>
</ul>
<p>We can apply requirements on the objects by applying <em>masks</em> to our event collections. For electrons, we will apply the following criteria to the electron fields, </p>
<ul>
<li><span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>&gt; 30 GeV, <span class="arithmatex"><span class="MathJax_Preview">|\eta|&lt;2.1</span><script type="math/tex">|\eta|<2.1</script></span></li>
<li>passing the tight identification requirements </li>
<li>3D impact parameter (<code>sip3d</code>) <span class="arithmatex"><span class="MathJax_Preview">&lt; 4</span><script type="math/tex">< 4</script></span></li>
</ul>
<p>Copy the code below to determine which events would pass this selection, 
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">selected_electrons</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="p">[(</span><span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="o">.</span><span class="n">pt</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">2.1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="o">.</span><span class="n">isTight</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">electron</span><span class="o">.</span><span class="n">sip3d</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="p">)]</span>
</span></code></pre></div></p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Create the same object masks for selected muons and selected jets based on the following criteria, </p>
<p>For muons: </p>
<ul>
<li><span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>&gt; 30 GeV, <span class="arithmatex"><span class="MathJax_Preview">|\eta|&lt;2.1</span><script type="math/tex">|\eta|<2.1</script></span> </li>
<li>passing the tight identification requirements  </li>
<li>3D impact parameter (<code>sip3d</code>) <span class="arithmatex"><span class="MathJax_Preview">&lt; 4</span><script type="math/tex">< 4</script></span></li>
<li>Relative isolation requirement (<code>pfreliso04DBCorr</code>) <span class="arithmatex"><span class="MathJax_Preview">&lt; 0.15</span><script type="math/tex">< 0.15</script></span>.</li>
</ul>
<p>For jets: </p>
<ul>
<li>Corrected (<code>corrpt</code>) <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>&gt; 30 GeV and <span class="arithmatex"><span class="MathJax_Preview">|\eta|&lt;2.4</span><script type="math/tex">|\eta|<2.4</script></span>  </li>
</ul>
</div>
<details>
<summary><b>Show answer</b></summary>

<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">selected_muons</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="p">[(</span><span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="o">.</span><span class="n">pt</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">2.1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="o">.</span><span class="n">isTight</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="o">.</span><span class="n">sip3d</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">muon</span><span class="o">.</span><span class="n">pfreliso04DBCorr</span> <span class="o">&lt;</span> <span class="mf">0.15</span><span class="p">)]</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">selected_jets</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">jet</span><span class="p">[(</span><span class="n">events</span><span class="o">.</span><span class="n">jet</span><span class="o">.</span><span class="n">corrpt</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">jet</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">2.4</span><span class="p">)</span> <span class="p">]</span>
</span></code></pre></div>
</details>

<h3 id="event-selection">Event selection</h3>
<p>Now we want to apply the event level filters to our events. To do this, we use the <code>ak.count</code> method to count the number of objects of each type that we require in our events. Looking at our final state, our event selection will be, </p>
<ul>
<li>Exactly one electron or muon that passes the electron/muon requirements </li>
<li>At least 4 jets, at least two of which should be a b-jet. </li>
</ul>
<p>For the first requirement, copy the following code into a Jupyter notebook cell and run it, 
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">event_filters</span> <span class="o">=</span> <span class="p">((</span><span class="n">ak</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">selected_electrons</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ak</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">selected_muons</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
The <code>+</code> acts as a logical <em>or</em> so that we are filtering on events that have exactly one electron or exactly one muon. Note that we could use another field of the object but here we have chosen to use <code>pt</code>. Remember, we want to apply the filter on each electron or muon in the events so the sum needs to be applied to the first layer (<code>axis=1</code>). </p>
<p>For the second requirement, we need to define how we <em>tag</em> a b-jet. We use the <em>combined secondary vertex</em> algorithm at CMS to do this. When this quantity is high, this implies that the jet originates from a vertex which is far from the pp interaction point, which indicates that the jet originates from a heavy quark with a long(ish) lifetime - i.e a b-quark. For our selection  we will define b-jets as those for which the  b-tagging variable <code>btag</code> is greater than or equal to 0.8. </p>
<p>The following code, which you should copy into a cell in your Jupyter notebook, will include the second requirement into our event filters, </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">event_filters</span> <span class="o">=</span> <span class="n">event_filters</span> <span class="o">&amp;</span>  <span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">selected_jets</span><span class="o">.</span><span class="n">corrpt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">selected_jets</span><span class="o">.</span><span class="n">btag</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
<p>Note that we haven't actually applied any of this selection to our events yet. If we check the length of our event filters, we can see that its still the same size as our events, 
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_filters</span><span class="p">))</span>
</span></code></pre></div></p>
<p>The reason is that this object now contains a boolean flag, one for each event, that indicates whether or not the event satisfies all of the criteria that we used to define the filter. To actually select the events that pass this filter, we just apply the filter to one of our selected object collections. For example, to obtain the collection of jets from all of the events that pass our selection, we can do, </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">selected_events</span> <span class="o">=</span> <span class="n">selected_jets</span><span class="p">[</span><span class="n">events_filter</span><span class="p">]</span>
</span></code></pre></div>
<p>As a final step, we want to plot some observable in our events that can separate the signal from the various backgrounds. Choosing observables often requires a lot of thought as physicists as there are several things we want to consider </p>
<ul>
<li>The observable should have some separation between signal and background to make it easier to extract the process that we are interested in. </li>
<li>The observable may be more or less susceptible to experimental effects such as detector resolution, pile-up or be theoretically more prone to divergences in the calculation (this can especially true in jet related observables). All of these tend to imply systematic uncertainties that can reduce the sensitivity. </li>
<li>The observable may lend itself to allowing for data-driven estimates of distributions for different backgrounds. This won't be the case here, but this can often be a good motivation for choosing certain variables. </li>
</ul>
<p>For this analysis, our chosen observable will be the mass of the hadronically decaying top-quark <span class="arithmatex"><span class="MathJax_Preview">m_{bjj}</span><script type="math/tex">m_{bjj}</script></span>. 
We can use the <code>ak.combinations</code> function to find all combinations of 3-jets (trijet) in the events. For each combination, we will calculate the four-momentum of the 3-jet system and require that at least one of the 3 jets in each trijet is b-tagged. </p>
<p>Copy the code below into a Jupyter notebook cell and run it, </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">trijet</span> <span class="o">=</span> <span class="n">ak</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">selected_events</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;j1&quot;</span><span class="p">,</span> <span class="s2">&quot;j2&quot;</span><span class="p">,</span> <span class="s2">&quot;j3&quot;</span><span class="p">])</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="c1"># Get the individual jets from each combination </span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">j1</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">j3</span> <span class="o">=</span> <span class="n">ak</span><span class="o">.</span><span class="n">unzip</span><span class="p">(</span><span class="n">trijet</span><span class="p">)</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="c1"># booleans for which combination has one of the 3 jets b-tagged</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">has_bjet</span> <span class="o">=</span> <span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">j1</span><span class="o">.</span><span class="n">btag</span><span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ak</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">j2</span><span class="o">.</span><span class="n">btag</span><span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ak</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">j3</span><span class="o">.</span><span class="n">btag</span><span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1"># apply the filter </span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">trijet</span> <span class="o">=</span> <span class="n">trijet</span><span class="p">[</span><span class="n">has_bjet</span><span class="p">]</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="n">trijet</span><span class="p">[</span><span class="s2">&quot;p4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trijet</span><span class="o">.</span><span class="n">j1</span> <span class="o">+</span> <span class="n">trijet</span><span class="o">.</span><span class="n">j2</span> <span class="o">+</span> <span class="n">trijet</span><span class="o">.</span><span class="n">j3</span> 
</span></code></pre></div>
<p>Note that in the last command, <code>p4</code> is a special field that has the space-time co-ordinates of a four-vector. This makes our calculations of things like the <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span> or mass of the trijets very easy. Below, we find the invariant mass of the trijet that has the highest <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">trijet_mass</span> <span class="o">=</span> <span class="n">trijet</span><span class="p">[</span><span class="s2">&quot;p4&quot;</span><span class="p">][</span><span class="n">ak</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">trijet</span><span class="o">.</span><span class="n">p4</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">mass</span>
</span></code></pre></div>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Create an observable for the <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span> of the trijet with the largest <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span>. </p>
</div>
<details>
<summary><b>Show answer</b></summary>

<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">trijet_pt</span> <span class="o">=</span> <span class="n">trijet</span><span class="p">[</span><span class="s2">&quot;p4&quot;</span><span class="p">][</span><span class="n">ak</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">trijet</span><span class="o">.</span><span class="n">p4</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">pt</span>
</span></code></pre></div>
</details>

<h2 id="histograms-and-saving-output">Histograms and saving output</h2>
<p>Now that we have our event observable, we can see what the distribution looks like for these events. 
First, we need to remove the array structure of the events so that we can use the plotting tools from matplotlib. We have to import this module too of course, 
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">observable</span> <span class="o">=</span> <span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">trijet_mass</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">575</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
</span></code></pre></div></p>
<p>You should see a plot similar to the one below, 
<img alt="basic ttbar" src="../images/basic.jpg" /></p>
<p>We see a peak close to the top mass (~175 GeV) as expected! The resolution of jets in the CMS detector is not very high so we do not see a very sharp peak, but we are clearly seeing the hadronic top quark here. </p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Make a plot of the <span class="arithmatex"><span class="MathJax_Preview">p_{T}</span><script type="math/tex">p_{T}</script></span> of the trijet instead of the mass. You should be careful to choose appropriate binning for this variable. </p>
</div>
<details>
<summary><b>Show answer</b></summary>

<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">observablept</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
</span></code></pre></div>
</details>

<p>As this sample is simulation, we need to apply proper event weights to account for the cross-section in the standard model. Remember that the number of events expected is given by the product of the cross-section and the integrated luminosity. For simulated samples, if we know the cross-section <span class="arithmatex"><span class="MathJax_Preview">\sigma</span><script type="math/tex">\sigma</script></span> and the number of events generated <span class="arithmatex"><span class="MathJax_Preview">N_{gen}</span><script type="math/tex">N_{gen}</script></span>, we can calculate the <em>effective luminosity</em> of the simulated sample as, </p>
<div class="arithmatex">
<div class="MathJax_Preview">
L_{eff}  =  N_{gen}/\sigma
</div>
<script type="math/tex; mode=display">
L_{eff}  =  N_{gen}/\sigma
</script>
</div>
<p>Often, there is a filtering step in either the MC generation or in the skimming step - we don't always manage to process all of the samples. It's important to account for this by scaling up the number of generated events by this filter efficiency <span class="arithmatex"><span class="MathJax_Preview">\epsilon</span><script type="math/tex">\epsilon</script></span>. So our formula changes to </p>
<div class="arithmatex">
<div class="MathJax_Preview">
L_{eff}  =  \frac{1}{\epsilon}\cdot N_{gen}/\sigma
</div>
<script type="math/tex; mode=display">
L_{eff}  =  \frac{1}{\epsilon}\cdot N_{gen}/\sigma
</script>
</div>
<p>The event weight for a particular sample will therefore be the ratio of the integrated luminosity of our real data to the effective luminosity of the sample, </p>
<div class="arithmatex">
<div class="MathJax_Preview">
w = L_{int}/L_{eff} =L_{int}\cdot \epsilon\cdot \sigma/N_{gen} 
</div>
<script type="math/tex; mode=display">
w = L_{int}/L_{eff} =L_{int}\cdot \epsilon\cdot \sigma/N_{gen} 
</script>
</div>
<p>Have a look again inside the <code>ntuples.json</code> file. You will find that the file contains the number of events for each file in each sample - <code>nevts</code> -  (this is the number generated and processed to make that file), the filter efficiency for the sample (<code>filter_eff</code>) and the cross-section in <span class="arithmatex"><span class="MathJax_Preview">pb</span><script type="math/tex">pb</script></span> - <code>xsec</code> for that sample. You can read in this data using the code below, </p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ntuples.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></code></pre></div>
From this information, you can now calculate the event weight for each of the simulated samples. Our integrated luminosity for this 2015 data is 2256.38 <span class="arithmatex"><span class="MathJax_Preview">pb</span><script type="math/tex">pb</script></span>. </p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Write a function to calculate the event weight (<code>getEventWeight</code>) for a given simulated sample, using the metadata from <code>ntuples.json</code>.  </p>
</div>
<details>
<summary><b>Show answer</b></summary>

<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">def</span> <span class="nf">getEventWeight</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="n">file_index</span><span class="p">):</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>    <span class="n">lumi</span> <span class="o">=</span> <span class="mf">2256.38</span> <span class="c1"># inv pb </span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="k">if</span> <span class="n">sample</span> <span class="o">!=</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>        <span class="n">xsec_weight</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="s1">&#39;filter_eff&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">metadata</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="s1">&#39;xsec&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">lumi</span> <span class="o">/</span> <span class="n">metadata</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="s1">&#39;nominal&#39;</span><span class="p">][</span><span class="n">file_index</span><span class="p">][</span><span class="s1">&#39;nevts&#39;</span><span class="p">]</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>        <span class="n">xsec_weight</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="k">return</span> <span class="n">xsec_weight</span>
</span></code></pre></div>
</details>

<p>Finally, we want to save our histogram in a format that can be interpreted by the <code>Combine</code> tool that we use for statistical analyses in CMS. There are many different formats that can be used, however we will use a simple <code>.csv</code> format for these exercises. </p>
<p>I have created a simple conversion function for you to use in the file <code>hist2df.py</code>. It's also copied below, </p>
<details>
<summary><b>Show python</b></summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="k">def</span> <span class="nf">histogramToDataframe</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">process</span><span class="p">,</span><span class="n">sys</span><span class="o">=</span><span class="s1">&#39;nominal&#39;</span><span class="p">):</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="n">df</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channel&#39;</span><span class="p">:[],</span><span class="s1">&#39;process&#39;</span><span class="p">:[],</span><span class="s1">&#39;systematic&#39;</span><span class="p">:[],</span><span class="s1">&#39;bin&#39;</span><span class="p">:[],</span><span class="s1">&#39;sum_w&#39;</span><span class="p">:[],</span><span class="s1">&#39;sum_ww&#39;</span><span class="p">:[]}</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="n">nbins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">channel</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">)]</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;process&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">process</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">)]</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;systematic&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">sys</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">)]</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sum_w&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sum_ww&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    <span class="n">ret</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="k">return</span> <span class="n">ret</span>
</span></code></pre></div>
</details>

<p>You can convert a histogram created with the matplotlib <code>hist</code> function to a dataframe using this function as follows, </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">weights</span> <span class="o">=</span>  <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">575</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">dfs</span> <span class="o">=</span> <span class="n">histogramToDataframe</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;signalregion&quot;</span><span class="p">,</span><span class="s2">&quot;ttbar&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Since we haven't included the event weights when making the histogram, we will multiply the column <code>sum_w</code> by this weight. 
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>event_weight  = getEventWeight(&#39;ttbar&#39;,0) # the weight needed when using only the first file 
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>dfs[&#39;sum_w&#39;]  *= event_weight 
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>dfs[&#39;sum_ww&#39;] *= event_weight*event_weight
</span></code></pre></div></p>
<p>Note that there is also a column in our dataframe called <code>sum_ww</code> that we have multiplied by the square of the event weight. This column is the <em>variance</em> of the bin contents due to the limited number of MC simulated events available. We'll discuss more about this column in later exercises. </p>
<p>Finally, we can save the histogram in the format needed later for <code>Combine</code> using, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>dfs.to_csv(&#39;histograms.csv&#39;,index=False)
</span></code></pre></div>
And you'll now see a file called <code>histograms.csv</code> in your file browser. </p>
<h2 id="full-analysis">Full analysis</h2>
<p>In this exercise, we only ran our selection and created a histogram for one of the files for one of our simulated processes. We should run the same selection over all of the simulated files and for the data too!</p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Write some code that will run over all of the simulated sample files and all of the data files too. Remember, </p>
<ol>
<li>Only look at the <code>nominal</code> samples. </li>
<li>Make a separate histogram for each of the different processes and for the data. Each simulated sample will have its own event weight that you'll need to calculate. </li>
<li>You can save all of the histograms to the same <code>.csv</code> file or you can save them in separate files.</li>
</ol>
<p>This may take some time so you should get some working code and then you may need to let the commands run for a couple of hours - maybe leave it running over dinner or even overnight. </p>
<p>Feel free to choose your own binning for your observable or you could even choose a different observable to the one we calculated in the example above! You might even try saving different histograms with different binnings/observables so that you can see what difference this makes for the statistical analysis later. </p>
<p>Please try to write your own code before looking at the answer provided. </p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You may find that sometimes you will see an <code>IOError</code> due to XRootD failing to access the remote files. This can be annoying so I recommend that you split up the task across different cells and that you wrap the command to open the file with a <code>try</code> <code>except</code> block similar to, 
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;root://eospublic.cern.ch//eos/opendata/cms/derived-data/POET/23-Jul-22/Run2015D_SingleMuon_flat/07FC2CD2-106C-4419-9260-12B3E271C345_flat.root&quot;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">try</span><span class="p">:</span> 
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="n">events</span> <span class="o">=</span> <span class="n">NanoEventsFactory</span><span class="o">.</span><span class="n">from_root</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">schemaclass</span><span class="o">=</span><span class="n">AGCSchema</span><span class="p">,</span> <span class="n">treepath</span><span class="o">=</span><span class="s1">&#39;events&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># sleep for 2 seconds and try one more time</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="k">try</span><span class="p">:</span> 
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>        <span class="n">events</span> <span class="o">=</span> <span class="n">NanoEventsFactory</span><span class="o">.</span><span class="n">from_root</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">schemaclass</span><span class="o">=</span><span class="n">AGCSchema</span><span class="p">,</span> <span class="n">treepath</span><span class="o">=</span><span class="s1">&#39;events&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># sleep for 2 seconds just to not try EOS again but give up on this file now</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>        <span class="k">return</span> <span class="p">[]</span>
</span></code></pre></div>
This will try to access a file twice before giving up and returning an empty list.</p>
<p>Remember, if you don't access the full set of files, you should recalculate the integrated luminosity (you can assume that the new integrated luminosity scales with the number of events accessed) and modify the function to calculate the event weight to account for missing simulated events. </p>
</div>
<details>
<summary>Show answer</summary>
<p>I have uploaded a Jupyter notebook that will perform the full analysis on the samples called <code>FullAnalysis.ipynb</code>in the <code>ttbarAnalysis</code> folder. If you really get stuck, have a look at this notebook to see how to run our object and event selection, calculate the observable and save the histograms for all of the samples. </p>
<p>The notebook will produce a plot similar to the one below,</p>
<p><img alt="mbjj_signal" src="../images/mbjj_signalregion.png" /></p>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../setup/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Getting started">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Getting started
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "navigation.footer"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>